<div class="card border-secondary">
  <div class="card-header text-white bg-secondary border-secondary">
    <i class="bi bi-broadcast-pin"></i> Manage Announcement
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-3 offset-10 mb-2">
        <button type="button" class="btn btn-primary btn-sm" (click)="onAddNew(addAnnouncement)">
          <i class="fa fa-plus-circle fa-fw text-warning"></i>Add New
        </button>
      </div>

      <div class="col-12">
        <div class="input-group input-group-sm mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">Filter By</span>
          </div>
          <input type="text" class="form-control" (keyup)="applyFilter($event)" placeholder="ID / Title" #input>
        </div>
      </div>
      <div class="col-12">
        <div class="example-container table-responsive">
          <table mat-table [dataSource]="data" matSort matSortActive="created" matSortDisableClear
            matSortDirection="desc" matSort class="table table-hover">
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
              <td mat-cell *matCellDef="let row"><button
                  class="btn btn-sm btn-link text-primary bi bi-eye-fill">{{row.id}}</button></td>
            </ng-container>
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
              <td mat-cell *matCellDef="let row">{{row.title}}</td>
            </ng-container>
            <ng-container matColumnDef="priority">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Priority</th>
              <td mat-cell *matCellDef="let row"><i [ngClass]="row.priority !== 1 ? 'text-primary' : 'text-light'"
                  class="bi bi-arrow-up-circle-fill text-primary" (click)="onPriorityClick(true, row)"></i>
                {{row.priority}} <i [ngClass]="row.priority !== row.total? 'text-primary' : 'text-light'"
                  class="bi bi-arrow-down-circle-fill " (click)="onPriorityClick(false, row)"></i></td>
            </ng-container>
            <ng-container matColumnDef="durationRestricted">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Duration Restricted</th>
              <td mat-cell *matCellDef="let row">
                <span *ngIf="row.durationRestricted === false">No</span>
                <span *ngIf="row.durationRestricted === true">Between : {{row.displayAfter}} &
                  {{row.displayUntil}}</span></td>
            </ng-container>
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
              <td mat-cell *matCellDef="let row"><label class=" text-white pr-1 pl-1 rounded-pill"
                  [ngClass]="{'bg-primary':row.status ==='Showing','bg-warning':row.status =='Disabled','bg-error':row.status =='Expired'}">
                  {{row.status}}</label></td>
            </ng-container>
            <ng-container matColumnDef="updatedBy">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Updated By</th>
              <td mat-cell *matCellDef="let row">{{row.updatedBy}}</td>
            </ng-container>
            <ng-container matColumnDef="dateUpdated">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Date Updated</th>
              <td mat-cell *matCellDef="let row">{{row.dateUpdated}}</td>
            </ng-container>
            <ng-container matColumnDef="editOption">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let row"><a class="btn btn-link btn-sm text-primary" #announcement><i
                    class="fa fa-pencil-square-o"></i>Edit</a></td>
            </ng-container>
            <ng-container matColumnDef="deleteOption">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let row"><a class="btn btn-link btn-sm text-danger"
                  (click)="onDelete(deleteAnnouncement, row)"><i class="bi bi-x"></i>Delete</a></td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns;  sticky: true;" class="thead-light;"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
        <mat-paginator showFirstLastButtons [length]="resultsLength" [pageSize]="reportParam.pagination.pageSize"
          [pageSizeOptions]="pageSizeOptions"></mat-paginator>
      </div>
    </div>
  </div>
</div>

<ng-template #deleteAnnouncement>
  <div class="card border-primary">
    <div class="card-header text-warning bg-primary border-primary">
      Delete Confirmation <i class="bi bi-x-circle float-right" (click)="onCancelClick()"></i>
    </div>
    <div class="card-body">
      <h5>Are you sure you want to delete announcement with title <b>({{selectedAnnouncement.title}})</b>?</h5>
    </div>
  </div>
  <div class="card-footer border-top border-primary">
    <button class="btn btn-primary btn-sm col-3 float-right"
      (click)="onDeleteConfirm(selectedAnnouncement.id)">Yes</button>
    <button class="btn btn-secondary btn-sm col-3 float-right mr-2 " (click)="onCancelClick()">No</button>
  </div>
</ng-template>

<ng-template #addAnnouncement>
  <form #f="ngForm">
    <div class="card border-primary">
      <div class="card-header text-warning bg-primary border-primary">
        {{announcementForm.title}} {{announcementForm.message}}<i class="bi bi-x-circle float-right"
          (click)="onCancelClick()"></i>
      </div>
      <div class="card-body">
        <div *ngIf="!announcementForm.inEditMode">
          <div class="row">
            <div class="input-group">
              <label class="col-sm-2 col-form-label col-form-label-sm">
                Select Image
              </label>
              <div class="col-sm-10">

                <input type="checkbox" name="imageURL" [(ngModel)]="announcementForm.defaultImage" id="imageURL"
                  [disabled]="announcementForm.inEditMode">
                <label class="col-form-label col-form-label-sm pl-2" for="imageURL">
                  Use Default Image
                </label>
                <br>
                <input type="file" class="form-control form-control-sm">
              </div>
            </div>
            <div class="input-group">

            </div>
          </div>
        </div>
      </div>
      <div class="card-footer border-top border-primary">
        <button class="btn btn-primary btn-sm col-3 float-right" type="submit"
          [disabled]="!f.valid || announcementForm.isBusy || !validateUserForm()" (click)="onSubmit(f)">Save</button>
        <button class="btn btn-secondary btn-sm col-3 float-right mr-2 " (click)="onCancelClick()"
          [disabled]="announcementForm.isBusy">Cancel</button>
      </div>
    </div>
  </form>
</ng-template>
